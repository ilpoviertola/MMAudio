defaults:
  - base_config
  - override data: slurm
  - override hydra/job_logging: custom
  - _self_

hydra:
  run:
    dir: ./output/${exp_id}
  output_subdir: train-${now:%Y-%m-%d_%H-%M-%S}-hydra

ema:
  start: 0

exp_id: controlnet_small-44k_m-to-l-ec_sum-post_preconv
model: small_44k_avs
mini_train: False
example_train: False
avs_train: True
weights: weights/mmaudio_small_44k.pth

log_text_interval: 20
log_extra_interval: 500
val_interval: 250
eval_interval: 4_000
save_eval_interval: 7_000
save_weights_interval: 1_500
save_checkpoint_interval: 1_500
save_copy_iterations: []

num_workers: 10
batch_size: 16
eval_batch_size: 4 # per-GPU

num_iterations: 35_000
learning_rate: 1.0e-5
linear_warmup_steps: 100

lr_schedule: step
lr_schedule_steps: [30_000, 33_000]
lr_schedule_gamma: 0.1

clip_grad_norm: 1.0
weight_decay: 1.0e-6

# increases ControlNetâ€™s ability to directly recognize semantics in the cond
null_text_condition_probability: 0.5

controlnet_cfg:
  # schema
  add_mask_f_to_latent: 1
  use_extended_c: 1
  use_global_c: 0
  add_mask_f_to_extended_c: 0
  add_mask_f_to_global_c: 0
  use_preprocess_conv: 1
  # aggregation
  for_joint_blocks: 1
  for_fused_blocks: 0
  for_latent: 1
  sum_pre_dit_block: 0
  sum_post_dit_block: 1
